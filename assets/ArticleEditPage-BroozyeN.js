import{d as w,s as k,g as s,h as I,o as u,c as r,b as D,f as h,e as C,M as E,k as b,t as M,_ as A,w as y,u as B}from"./index-B9vTfeto.js";import{E as V}from"./EntryPageView-B_k5DaEE.js";import{I as $}from"./IconButton-CHNMKwbQ.js";import{I as j}from"./ArticleImageList-C6PyCa25.js";import"./TextInput-Be5mo-wx.js";import"./PhotoDragDrop-B-a394b-.js";import"./FormWrapper-CKm7w-vs.js";const P={key:0},T=w({__name:"ArticleDeleteButton",setup(R){const p=k(),i=s(""),o=s(""),n=s(!1),e=s("記事を削除しますか？"),d=s("実行"),v=s("キャンセル"),m=()=>{n.value=!0},g=()=>{console.log("モーダルがキャンセルされました。"),n.value=!1};I(()=>{const t=p.path.match(/\/edit\/(\d+)$/);t?i.value=t[1]:o.value="記事IDが見つかりません"});const f=async()=>{i.value||(o.value="有効な記事IDがありません");try{const l=`https://yellowokapi2.sakura.ne.jp/Vue/api/ArticleDeleteAPI.php/${i.value}`,t=await fetch(l);if(!t.ok)throw new Error(`サーバーエラー: ${t.statusText}`);const a=await t.json();a.true?o.value=a.true:o.value=a.error}catch(l){l instanceof Error?o.value=`リクエストエラー: ${l.message}`:o.value="予期しないエラーが発生しました"}};return(l,t)=>(u(),r("div",null,[D("div",null,[h($,{label:"削除",class:"delete-button",backgroundColor:"danger",onClick:m}),n.value?(u(),C(E,{key:0,message:e.value,confirmText:d.value,cancelText:v.value,isVisible:n.value,onConfirm:f,onCancel:g},null,8,["message","confirmText","cancelText","isVisible"])):b("",!0)]),o.value?(u(),r("p",P,M(o.value),1)):b("",!0)]))}}),U=A(T,[["__scopeId","data-v-32a44d66"]]),S={key:0},N={key:1},F=w({__name:"ArticleEditPage",setup(R){const p=k(),i=B(),o=s(""),n=s(""),e=s(null),d=async()=>{var l;if(!o.value){console.error("記事IDが見つかりません");return}try{const t=await fetch(`https://yellowokapi2.sakura.ne.jp/Vue/api/BlogAllCatchAPI.php/${o.value}`);if(!t.ok)throw new Error("データの取得に失敗しました");const a=await t.json();if(a.tags){const c=a.tags.join(","),_=await fetch(`https://yellowokapi2.sakura.ne.jp/Vue/api/TagResolverAPI.php/${c}`);if(!_.ok)throw new Error("タグNameの取得に失敗しました");const x=await _.json();e.value={illust_title:a.illust_title||"",tags:x.tagName||"",illust_body:a.illust_body||"",public:String(a.public??"0"),R18:String(a.R18??"0"),thumbnail_url:a.thumbnail_url||"",images:a.images||[]}}(l=e.value)!=null&&l.thumbnail_url&&v(e.value.thumbnail_url)}catch(t){console.error("エラーが発生しました:",t)}},v=l=>{e.value&&(e.value.thumbnail_url=l)},m=l=>{var c;const t=(c=l.target.files)==null?void 0:c[0];if(!t)return;const a=new FileReader;a.onload=()=>{e.value&&(e.value.thumbnail_url=a.result)},a.readAsDataURL(t)},g=async()=>{if(!e.value){console.error("フォームデータが存在しません");return}const l=new FormData;e.value.illust_title&&l.append("illust_title",e.value.illust_title),e.value.tags&&l.append("tags",e.value.tags),e.value.illust_body&&l.append("illust_body",e.value.illust_body),e.value.public&&l.append("public",e.value.public),e.value.R18&&l.append("R18",e.value.R18),e.value.thumbnail_url&&l.append("thumbnail_url",e.value.thumbnail_url);try{const t=await fetch(`https://yellowokapi2.sakura.ne.jp/Vue/api/UpdateArticleAPI.php/${o.value}`,{method:"POST",body:l});if(!t.ok)throw new Error("データの送信に失敗しました");const a=await t.json();console.log("APIの応答:",a),alert("データが正常に送信されました"),i.push({path:"/article"})}catch(t){console.error("エラーが発生しました:",t),alert("データの送信に失敗しました")}},f=()=>{g()};return I(()=>{const t=p.path.match(/\/edit\/(\d+)$/);t?o.value=t[1]:n.value="記事IDが見つかりません",d()}),(l,t)=>(u(),r("div",null,[e.value?(u(),C(V,{key:0,title:e.value.illust_title,tags:e.value.tags,body:e.value.illust_body,publish:e.value.public,adultsOnly:e.value.R18,imageBase64:e.value.thumbnail_url,"onUpdate:title":t[0]||(t[0]=a=>e.value&&(e.value.illust_title=a)),"onUpdate:tags":t[1]||(t[1]=a=>{e.value&&(e.value.tags=a.replace(/[\s　,]+/g,","))}),"onUpdate:body":t[2]||(t[2]=a=>e.value&&(e.value.illust_body=a)),"onUpdate:publish":t[3]||(t[3]=a=>e.value&&(e.value.public=a)),"onUpdate:adultsOnly":t[4]||(t[4]=a=>e.value&&(e.value.R18=a)),onHandleImageChange:m,onSubmit:f},{top:y(()=>[e.value.images?(u(),r("div",S,[h(j,{images:e.value.images,Edit:!0},null,8,["images"])])):b("",!0)]),bottom:y(()=>[h(U)]),_:1},8,["title","tags","body","publish","adultsOnly","imageBase64"])):(u(),r("div",N,t[5]||(t[5]=[D("p",null,"データを読み込み中...",-1)])))]))}}),K=A(F,[["__scopeId","data-v-dd25927e"]]);export{K as default};
