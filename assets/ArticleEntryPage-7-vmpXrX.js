import{E as P}from"./EntryPageView-Dmcd3hsp.js";import{d as E,g as s,h as j,i as B,o as b,c as T,b as o,f as y,t as k,u as L,_ as R,j as $,e as S}from"./index-lzizTrR5.js";import{I as O}from"./IconButton-Bwx97DTe.js";import{I as F}from"./ArticleImageList-C2LJM3l4.js";import"./TextInput-DzyqH3TE.js";import"./PhotoDragDrop-BPRvkThD.js";import"./FormWrapper-Bhh730Tu.js";const C={class:"container"},x={class:"preview-card"},A={class:"main-layout"},D={class:"container-main"},z={class:"title-favorite-wrapper"},N={class:"title"},V={class:"favorite"},W={class:"dtl"},H={class:"footer-buttons"},J=E({__name:"ArticlePreviewPage",props:{id:{},title:{},tags:{},body:{},images:{},publish:{},adultsOnly:{}},setup(U){const a=U,u=L(),n=s(a.id),l=s(a.title),d=s(a.tags),i=s(a.body),c=s(a.publish),p=s(a.adultsOnly),v=s(a.images||[]),m=s([]),g=s([]);m.value=v.value.map((e,t)=>{e instanceof File||console.warn(`⚠️ imageFiles[${t}] は File 型じゃないよ：`,e);try{return URL.createObjectURL(e)}catch(w){return console.error(`❌ createObjectURL 失敗 at index ${t}:`,w),""}});const f=async()=>{const e=new FormData;v.value.forEach(t=>{e.append("image[]",t)}),e.append("user_id",n.value),e.append("illust_title",l.value),e.append("tags",d.value),e.append("ilust_body",i.value),e.append("public",c.value),e.append("R18",p.value);try{const t=await fetch("https://yellowokapi2.sakura.ne.jp/Vue/api/ArticleEntry.php",{method:"POST",body:e});if(!t.ok)throw new Error(`HTTPエラー: ${t.status}`);if((t.headers.get("Content-Type")||"").includes("application/json")){const I=await t.json();console.log("送信成功:",I),alert("データが正常に送信されました"),u.push({path:`/${n.value}`})}else console.log("レスポンスがJSONではありません。")}catch(t){console.error("送信エラー:",t)}},_=s(window.innerWidth>800),h=()=>{_.value=window.innerWidth>800},r=()=>{g.value=[];for(let e=0;e<m.value.length;e++)g.value.push({image_id:e,image_url:m.value[e],sort_order:e})};return j(()=>{window.addEventListener("resize",h),r()}),B(()=>{window.removeEventListener("resize",h)}),(e,t)=>(b(),T("div",C,[o("div",x,[o("div",A,[o("div",D,[y(F,{images:g.value??[]},null,8,["images"]),o("div",z,[o("h1",N,k(l.value||"タイトルなし"),1),o("span",V,[y(O,{label:"いいね","icon-class":"fa-regular fa-heart",color:"red"})])]),o("div",W,k(i.value||"本文が入っていません"),1)])]),o("div",H,[y(O,{label:"戻る",onClick:t[0]||(t[0]=w=>e.$router.back())}),y(O,{label:"投稿する",onClick:f})])])]))}}),M=R(J,[["__scopeId","data-v-7cd92027"]]),ee=E({__name:"ArticleEntryPage",setup(U){const a=s(""),u=s(""),n=s(""),l=s(""),d=s(""),i=s(""),c=s([]),p=s(!1),v=s([]),m=$();a.value=m.id??"3";const g=r=>{c.value=r},f=r=>{v.value=r.split(",").map(e=>e.trim()),n.value=v.value.join(", ")},_=()=>{p.value=!0},h=()=>{p.value=!1};return(r,e)=>(b(),T("div",null,[p.value?(b(),S(M,{key:1,id:a.value,title:u.value,tags:n.value,body:l.value,images:c.value,publish:d.value,adultsOnly:i.value,onReset:h},null,8,["id","title","tags","body","images","publish","adultsOnly"])):(b(),S(P,{key:0,title:u.value,tags:n.value,body:l.value,publish:d.value,adultsOnly:i.value,images:c.value,"onUpdate:title":e[0]||(e[0]=t=>u.value=t),"onUpdate:tags":f,"onUpdate:body":e[1]||(e[1]=t=>l.value=t),"onUpdate:publish":e[2]||(e[2]=t=>d.value=t),"onUpdate:adultsOnly":e[3]||(e[3]=t=>i.value=t),"onUpdate:images":g,onSubmit:_},null,8,["title","tags","body","publish","adultsOnly","images"]))]))}});export{ee as default};
