import{d as k,g as f,l as I,o as l,c as r,b as a,F as P,r as U,a as W,f as m,w as S,m as G,t as y,_ as w,j as q,h as b,e as M,k as x,p as O,n as H,q as R,i as K,s as Q}from"./index-B9vTfeto.js";import{I as C}from"./IconButton-CHNMKwbQ.js";import{I as X}from"./ArticleImageList-C6PyCa25.js";import{F as Y}from"./FollowButton-gspWPCMv.js";import{T as Z}from"./TextInput-Be5mo-wx.js";const ee={class:"tags-container"},te=k({__name:"ArticleTags",props:{tagsMsg:{type:Array,default:()=>[]}},setup(g){const t=g,e=f([]),s=f([]),u=async()=>{if(t.tagsMsg.length===0){e.value=[],s.value=[];return}const d=t.tagsMsg.join(",");try{const c=await(await fetch(`https://yellowokapi2.sakura.ne.jp/Vue/api/TagResolverAPI.php/${d}`)).json();c&&c.tagName&&c.tagIds?(e.value=c.tagName.split(","),s.value=c.tagIds):(console.log("タグが取得できませんでした"),e.value=[],s.value=[])}catch(h){console.error("タグの取得に失敗しました",h),e.value=[],s.value=[]}};return I(()=>t.tagsMsg,async()=>{await u()},{immediate:!0}),(d,h)=>{const c=W("router-link");return l(),r("div",ee,[a("ul",null,[(l(!0),r(P,null,U(e.value,(v,p)=>(l(),r("li",{key:p},[m(c,{to:{path:"/search",query:{tag:s.value[p]}},class:"router-link"},{default:S(()=>[G(" #"+y(v),1)]),_:2},1032,["to"])]))),128))])])}}}),oe=w(te,[["__scopeId","data-v-c2e5a6de"]]),se={class:"liked-container"},ae=k({__name:"FavoriteButton",props:{i_id:{}},setup(g){const t=g,e=f(!1),s=f(!0),u=f([]),d=f(""),h=f(""),c=q();d.value=c.id??"0";const v=async()=>{try{const o=`https://yellowokapi2.sakura.ne.jp/Vue/api/FavoriteGetAPI.php/${d.value}`,n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.i_id})});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const _=await n.json();console.log("APIレスポンス (favoriteGetAPI):",_),u.value=Array.isArray(_.i_id)?_.i_id.map(Number):[],e.value=u.value.includes(Number(t.i_id))}catch(o){console.error("Error fetching latest like status:",o)}};let p=!1;const i=async()=>{if(!p){p=!0;try{await v();const o=e.value?"delete":"insert",n=`https://yellowokapi2.sakura.ne.jp/Vue/api/FavoriteToggleAPI.php/${h.value}/${o}`,_=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.i_id})});if(!_.ok)throw new Error(`HTTP error! Status: ${_.status}`);const $=await _.json();$.success?await v():console.error("エラー: "+JSON.stringify($))}catch(o){console.error("Error posting data:",o)}finally{p=!1}}};return I(()=>t.i_id,async o=>{typeof o=="number"&&o>0&&d.value!==""&&(h.value=`${o}/${d.value}`,await v())},{immediate:!0}),b(async()=>{t.i_id>0&&d.value!==""&&(h.value=`${t.i_id}/${d.value}`,await v(),s.value=!1)}),(o,n)=>(l(),r("div",se,[m(C,{label:e.value?"いいね済み":"いいね",iconClass:e.value?"fa-solid fa-heart":"fa-regular fa-heart",color:e.value?"white":"red",backgroundColor:e.value?"favorite":"primary",textColor:"white",onClick:i},null,8,["label","iconClass","color","backgroundColor"])]))}}),ne=w(ae,[["__scopeId","data-v-35904d68"]]),le={class:"nav-wrapper"},ie={class:"button-wrapper"},re={class:"button-wrapper"},ce=k({__name:"PrevNextButtons",props:{prevId:{},nextId:{}},setup(g){const t=g;return(e,s)=>{const u=W("router-link");return l(),r("div",le,[a("div",ie,[t.prevId!==0?(l(),M(u,{key:0,to:`/posts/${t.prevId}`},{default:S(()=>[m(C,{label:"前の記事","icon-class":"fa-solid fa-arrow-left",backgroundColor:"secondary",textColor:"white"})]),_:1},8,["to"])):x("",!0)]),s[0]||(s[0]=a("div",{class:"divider"},null,-1)),a("div",re,[t.nextId!==0?(l(),M(u,{key:0,to:`/posts/${t.nextId}`},{default:S(()=>[m(C,{label:"次の記事","icon-class":"fa-solid fa-arrow-right",backgroundColor:"secondary",textColor:"white"})]),_:1},8,["to"])):x("",!0)])])}}}),de=w(ce,[["__scopeId","data-v-82d800d5"]]),pe={class:"container"},ue={class:"profile-row"},_e=["src"],me={key:1,src:"https://yellowokapi2.sakura.ne.jp/Blog/index/profile_photo/noimage.png",alt:"Sample Profile Image",class:"image"},ve={class:"info"},fe={class:"userName"},he={class:"userId"},ge=k({__name:"UserProfile",props:{name:{},profile_id:{},profile_login_id:{},p_photo:{}},setup(g){const t=g;return(e,s)=>(l(),r("div",pe,[a("div",ue,[t.p_photo?(l(),r("img",{key:0,src:`https://yellowokapi2.sakura.ne.jp/Blog/index${t.p_photo}`,alt:"Profile Image",class:"image"},null,8,_e)):(l(),r("img",me)),a("div",ve,[a("p",fe,y(t.name||"unknown"),1),a("p",he,"ID: "+y(t.profile_login_id||"****"),1)]),m(Y,{f_id:t.profile_id},null,8,["f_id"])])]))}}),z=w(ge,[["__scopeId","data-v-9ac7b8f4"]]),ye={class:"container"},ke={class:"count"},we={class:"comment-group"},$e={class:"comment-submit"},Ie={key:0,class:"comment-item"},be=["src"],xe={class:"comment-body"},Ce={class:"comment-user"},Pe={class:"comment-text"},Se={key:1,class:"comment-item"},je={key:1,class:"no-comments"},Ae=k({__name:"CommentSection",props:{post_id:{}},setup(g){const t=g,e=q(),s=f(null),u=f(!1),d=f(""),h=async()=>{var o;if(!d.value.trim()){alert("コメントを入力してください");return}const i=new FormData;i.append("post_id",t.post_id.toString()),i.append("user_id",e.id.toString()),i.append("body",d.value);try{const _=await(await fetch("https://yellowokapi2.sakura.ne.jp/Vue/api/CommentInsertAPI.php",{method:"POST",body:i})).json();console.log("投稿結果"+_),_.success?((o=s.value)==null||o.comment.push(_.comment),d.value=""):alert(_.error||"送信に失敗しました")}catch(n){console.error("Error:",n),alert("通信エラーです:")}},c=async()=>{try{const i=await fetch(`https://yellowokapi2.sakura.ne.jp/Vue/api/CommentAllCatchAPI.php/${t.post_id}`);s.value=await i.json(),console.log(s.value)}catch(i){console.error("Error fetching data:",i)}},v=O(()=>{var i;return(i=s.value)!=null&&i.comment?u.value?s.value.comment:s.value.comment.slice(0,3):[]}),p=O(()=>s.value?s.value.comment.length:0);return b(()=>{t.post_id&&c()}),I(()=>t.post_id,i=>{i&&c()}),I(p,()=>{c()}),(i,o)=>(l(),r("div",ye,[a("p",ke,"コメント( "+y(p.value)+" )",1),a("div",we,[m(Z,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=n=>d.value=n),text:"コメントを書く",type:"textarea",class:"comment-textarea"},null,8,["modelValue"])]),a("div",$e,[m(C,{label:"送信",backgroundColor:"secondary",onClick:h})]),p.value>0?(l(),r("div",{key:0,class:H(["comment-list",{scrollable:u.value&&p.value>10}])},[(l(!0),r(P,null,U(v.value,n=>(l(),r(P,{key:n.comment_id},[n.deleted_at?(l(),r("div",Se,o[3]||(o[3]=[R('<img src="https://placehold.jp/40x40.png" alt="削除ユーザーアイコン" class="comment-icon" data-v-21d51669><div class="comment-body" data-v-21d51669><p class="comment-user" data-v-21d51669>deleted</p><p class="comment-text" style="font-style:italic;color:#999;" data-v-21d51669> このコメントは削除されました </p><div class="comment-actions" data-v-21d51669><span style="font-size:0.8em;color:#bbb;" data-v-21d51669>※このコメントは削除済みです</span></div></div>',2)]))):(l(),r("div",Ie,[a("img",{src:n.profile_photo?"https://yellowokapi2.sakura.ne.jp/Blog/index"+n.profile_photo:"https://placehold.jp/40x40.png",alt:"ユーザーアイコン",class:"comment-icon"},null,8,be),a("div",xe,[a("p",Ce,y(n.profile_name),1),a("p",Pe,y(n.comment_body),1),o[2]||(o[2]=a("div",{class:"comment-actions"},null,-1))])]))],64))),128))],2)):(l(),r("p",je,"コメントはありません")),!u.value&&p.value>3?(l(),r("p",{key:2,class:"show-all-comments",onClick:o[1]||(o[1]=n=>u.value=!0)}," すべてのコメントを表示 ")):x("",!0)]))}}),J=w(Ae,[["__scopeId","data-v-21d51669"]]),Ne={class:"main-layout"},Te={class:"container main"},Be={class:"title-favorite-wrapper"},Ve={class:"title"},Fe={class:"favorite"},Ee={class:"dtl"},Le={key:0,class:"prev-next-wrapper"},De={key:0,class:"sidebar"},Me={key:1,class:"sidebar-mobile"},Oe=k({__name:"ArticlePage",setup(g){const t=Q(),e=f(),s=async()=>{const h=f(t.params.id),v=await(await fetch(`https://yellowokapi2.sakura.ne.jp/Vue/api/BlogAllCatchAPI.php/${h.value}`)).json();v.images.sort((p,i)=>p.sort_order-i.sort_order),e.value=v};b(s),I(()=>t.params.id,()=>{s()});const u=f(window.innerWidth>800),d=()=>{u.value=window.innerWidth>800};return b(()=>{window.addEventListener("resize",d)}),K(()=>{window.removeEventListener("resize",d)}),(h,c)=>{var v,p,i,o,n,_,$,j,A,N,T,B,V,F,E,L,D;return l(),r("div",Ne,[a("div",Te,[m(X,{images:((v=e.value)==null?void 0:v.images)??[]},null,8,["images"]),a("div",Be,[a("h1",Ve,y((p=e.value)==null?void 0:p.illust_title),1),a("span",Fe,[m(ne,{i_id:((i=e.value)==null?void 0:i.illust_id)??0},null,8,["i_id"])])]),a("div",Ee,y(((o=e.value)==null?void 0:o.illust_body)||"本文が入っていません"),1),m(oe,{tagsMsg:((n=e.value)==null?void 0:n.tags)??[]},null,8,["tagsMsg"]),e.value?(l(),r("div",Le,[m(de,{prevId:((_=e.value)==null?void 0:_.prev_id)??0,nextId:(($=e.value)==null?void 0:$.next_id)??0},null,8,["prevId","nextId"])])):x("",!0)]),u.value?(l(),r("div",De,[m(z,{profile_id:((j=e.value)==null?void 0:j.profile_id)??0,name:((A=e.value)==null?void 0:A.profile_name)??"deleted user",p_photo:(N=e.value)==null?void 0:N.profile_photo,profile_login_id:(T=e.value)==null?void 0:T.profile_login_id},null,8,["profile_id","name","p_photo","profile_login_id"]),c[0]||(c[0]=a("div",{class:"sidebar-divider"},null,-1)),m(J,{post_id:((B=e.value)==null?void 0:B.illust_id)||0},null,8,["post_id"])])):(l(),r("div",Me,[m(z,{profile_id:((V=e.value)==null?void 0:V.profile_id)??0,name:((F=e.value)==null?void 0:F.profile_name)??"deleted user",p_photo:(E=e.value)==null?void 0:E.profile_photo,profile_login_id:(L=e.value)==null?void 0:L.profile_login_id},null,8,["profile_id","name","p_photo","profile_login_id"]),c[1]||(c[1]=a("div",{class:"sidebar-divider"},null,-1)),m(J,{post_id:((D=e.value)==null?void 0:D.illust_id)||0},null,8,["post_id"])]))])}}}),Ge=w(Oe,[["__scopeId","data-v-a3608d46"]]);export{Ge as default};
