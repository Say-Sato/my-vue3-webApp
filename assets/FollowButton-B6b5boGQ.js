import{I as h}from"./IconButton-Bwx97DTe.js";import{d as v,g as r,j as _,l as y,h as m,o as F,c as k,f as $,_ as b}from"./index-lzizTrR5.js";const S=v({__name:"FollowButton",props:{f_id:{}},setup(p){const a=p,e=r(!1),d=r(!0),f=r([]),l=r(""),c=r(""),w=_();l.value=w.id??"0";const n=async()=>{try{const o=`https://yellowokapi2.sakura.ne.jp/Vue/api/FollowGetAPI.php/${l.value}`;console.log(`リクエストURL (fetchLatestFollowStatus): ${o}`);const s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.f_id})});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const t=await s.json();console.log("APIレスポンス (FollowGetAPI):",t),f.value=Array.isArray(t.followed_id)?t.followed_id.map(Number):[],e.value=f.value.includes(Number(a.f_id)),console.log("最新のフォロー状態 (isFollowed):",e.value)}catch(o){console.error("Error fetching latest follow status:",o)}};let i=!1;const g=async()=>{if(!i){i=!0;try{await n(),console.log("Before toggle, isFollowed:",e.value);const o=e.value?"delete":"insert";console.log(`トグル処理: ${o}`);const s=`https://yellowokapi2.sakura.ne.jp/Vue/api/FollowToggleAPI.php/${c.value}/${o}`;console.log(`リクエストURL (toggleFollow): ${s}`);const t=await fetch(s);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const u=await t.json();u.success?(await n(),console.log("成功:",u.success)):console.error("エラー: "+JSON.stringify(u))}catch(o){console.error("Error posting data:",o)}finally{i=!1}}};return y(()=>a.f_id,async o=>{typeof o=="number"&&o>0&&l.value!==""&&(c.value=`${l.value}/${o}`,await n())},{immediate:!0}),m(async()=>{a.f_id>0&&l.value!==""&&(c.value=`${l.value}/${a.f_id}`,await n(),d.value=!1)}),(o,s)=>(F(),k("div",null,[$(h,{label:e.value?"フォロー中":"フォロー",iconClass:e.value?"fa-solid fa-user-check":"fa-solid fa-user-plus",color:"white",backgroundColor:e.value?"secondary":"primary",textColor:"white",onClick:g},null,8,["label","iconClass","backgroundColor"])]))}}),P=b(S,[["__scopeId","data-v-748d34b2"]]);export{P as F};
