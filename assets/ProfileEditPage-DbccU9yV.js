import{d as B,g as p,l as u,p as _,o as f,c,x as S,y as h,b as s,F as k,r as U,z as j,t as P,_ as C,j as A,k as M,f as v,A as K,v as O}from"./index-lzizTrR5.js";import{T as I}from"./TextInput-DzyqH3TE.js";import{P as R,R as $}from"./PhotoDragDrop-BPRvkThD.js";import{I as x}from"./IconButton-Bwx97DTe.js";import"./FormWrapper-Bhh730Tu.js";const Y={class:"birthday-select"},z=["value"],H=["value"],J=["value"],L=B({__name:"BirthDate",props:{modelValue:{}},emits:["update:modelValue"],setup(D,{emit:N}){const n=D,w=N,d=p(""),m=p(""),i=p("");u(()=>n.modelValue,l=>{if(l&&l.includes("-")){const[o,a,g]=l.split("-");d.value=o,m.value=String(Number(a)),i.value=String(Number(g))}},{immediate:!0}),u([d,m,i],()=>{const l=d.value,o=m.value.padStart(2,"0"),a=i.value.padStart(2,"0");l&&o&&a&&w("update:modelValue",`${l}-${o}-${a}`)});const b=_(()=>{const l=parseInt(d.value),o=parseInt(m.value);return!l||!o?[]:Array.from({length:new Date(l,o,0).getDate()},(a,g)=>g+1)}),y=new Date().getFullYear(),V=Array.from({length:y-1900+1},(l,o)=>1900+o);return(l,o)=>(f(),c("div",Y,[S(s("select",{"onUpdate:modelValue":o[0]||(o[0]=a=>d.value=a)},[o[3]||(o[3]=s("option",{disabled:"",value:""},"年",-1)),(f(!0),c(k,null,U(j(V),a=>(f(),c("option",{key:a,value:String(a)},P(a),9,z))),128))],512),[[h,d.value]]),S(s("select",{"onUpdate:modelValue":o[1]||(o[1]=a=>m.value=a)},[o[4]||(o[4]=s("option",{disabled:"",value:""},"月",-1)),(f(),c(k,null,U(12,a=>s("option",{key:a,value:String(a)},P(a),9,H)),64))],512),[[h,m.value]]),S(s("select",{"onUpdate:modelValue":o[2]||(o[2]=a=>i.value=a)},[o[5]||(o[5]=s("option",{disabled:"",value:""},"日",-1)),(f(!0),c(k,null,U(b.value,a=>(f(),c("option",{key:a,value:String(a)},P(a),9,J))),128))],512),[[h,i.value]])]))}}),q=C(L,[["__scopeId","data-v-6157339c"]]),G={key:0,class:"error-message"},Q={class:"profile-item"},W={class:"profile-item"},X={class:"profile-item"},Z={class:"profile-item"},ee={class:"profile-item"},te={class:"profile-item"},oe={class:"submit-edit"},ae=B({__name:"ProfileEditPage",props:{userName:{},certificate18:{},profilePhoto:{},password:{},body:{},birthDate:{},editProfile:{type:Boolean}},emits:["submit","update:editProfile"],setup(D,{emit:N}){const n=D,w=N,d=p(""),m=p(""),i=p("0"),b=p(""),y=p(""),V=p([]),l=p({userName:!1,password:!1,body:!1,birthDate:!1,certificate18:!1,profilePhoto:!1});u(()=>n.userName,e=>{e!==void 0&&(d.value=e)},{immediate:!0}),u(()=>n.password,e=>{e!==void 0&&(m.value=e)},{immediate:!0}),u(()=>n.certificate18,e=>{(e!=null||e==="0")&&(i.value=String(e))},{immediate:!0}),u(()=>n.body,e=>{e!==void 0&&(b.value=e)},{immediate:!0}),u(()=>n.birthDate,e=>{e!==void 0&&(y.value=e)},{immediate:!0}),u(d,e=>l.value.userName=e!==n.userName),u(m,e=>l.value.password=e!==n.password),u(b,e=>l.value.body=e!==n.body),u(y,e=>l.value.birthDate=e!==n.birthDate),u(i,e=>l.value.certificate18=e!==n.certificate18),u(V,e=>l.value.profilePhoto=e.length>0);const o=p(""),a=A(),g=p(a.id),T=async()=>{const e=new FormData;l.value.userName&&e.append("userName",d.value||""),l.value.password&&e.append("password",m.value||""),l.value.certificate18&&e.append("certificate18",i.value||"0"),l.value.body&&e.append("body",b.value||""),l.value.birthDate&&e.append("birthDate",y.value||""),l.value.profilePhoto&&V.value.length>0&&e.append("profilePhoto",V.value[0]);try{const t=await fetch(`https://yellowokapi2.sakura.ne.jp/Vue/api/ProfileEditAPI.php/${g.value}`,{method:"POST",body:e});if(!(t.headers.get("Content-Type")||"").includes("application/json"))throw new Error("サーバーからJSON形式の返答がありませんでした。");const F=await t.json();if(!t.ok)throw new Error(F.message||`HTTP ${t.status}`);alert("データが正常に送信されました"),w("submit"),w("update:editProfile",!1)}catch(t){console.error("更新失敗:",t),o.value="更新に失敗しました。もう一度お試しください。"}},E=()=>{w("update:editProfile",!1)};return(e,t)=>(f(),c("form",{onKeydown:t[7]||(t[7]=K(O(()=>{},["prevent"]),["enter"]))},[o.value?(f(),c("div",G,P(o.value),1)):M("",!0),s("div",Q,[t[8]||(t[8]=s("label",{for:"image"},"プロフィール画像",-1)),v(R,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=r=>V.value=r),maxCount:1},null,8,["modelValue"])]),s("div",W,[t[9]||(t[9]=s("label",null,"生年月日",-1)),v(q,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=r=>y.value=r)},null,8,["modelValue"])]),s("div",X,[t[10]||(t[10]=s("label",{for:"userName"},"名前",-1)),v(I,{id:"userName",name:"userName",type:"text",modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=r=>d.value=r)},null,8,["modelValue"])]),s("div",Z,[t[11]||(t[11]=s("label",{for:"body"},"プロフィール本文",-1)),v(I,{id:"body",name:"body",type:"textarea",modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=r=>b.value=r)},null,8,["modelValue"])]),s("div",ee,[t[12]||(t[12]=s("label",{for:"password"},"パスワード",-1)),v(I,{id:"password",name:"password",type:"password",modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=r=>m.value=r)},null,8,["modelValue"])]),s("div",te,[t[13]||(t[13]=s("label",null,"年齢制限ありの画像を表示する",-1)),v($,{id:"show",name:"certificate18",value:"1",label:"表示",modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=r=>i.value=r)},null,8,["modelValue"]),v($,{id:"hide",name:"certificate18",value:"0",label:"非表示",modelValue:i.value,"onUpdate:modelValue":t[6]||(t[6]=r=>i.value=r)},null,8,["modelValue"])]),s("div",oe,[v(x,{label:"キャンセル",backgroundColor:"secondary",onClick:E,type:"button"}),v(x,{label:"保存する",onClick:T,type:"button"})])],32))}}),ne=C(ae,[["__scopeId","data-v-b32e93a1"]]);export{ne as default};
